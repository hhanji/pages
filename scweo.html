
<html>
<head>
<title>
Safe Concurrency With Exclusive Ownership 
</title>
<link rel="stylesheet" href="pygments.css">

<style type='text/css'>
body {
   background: black;
   color: white;
   font-family: sans-serif;
}

.linkbar {
   width: 20%;
   float: left;
   margin: 1em;
   position: fixed;
   height: 90vh;
   overflow-y: auto;
}

.linkbar a{
   color: black;
   background: #aaa;
   border-top: 2px solid #eee;
   border-left: 2px solid #eee;
   border-bottom: 2px solid #666;
   border-right: 2px solid #666;
   padding: 0.2em;
   margin: 0.2em;
   display: block;
   text-decoration: none;
}

.linkbar a:active {
   background: #888;
   border-top: 2px solid #666;
   border-left: 2px solid #666;
   border-bottom: 2px solid #eee;
   border-right: 2px solid #eee;
}

#content {
   display: inline-block;
   margin-left: 25%;
   width: 40em;
   max-width: 70%;
}

td, th {
   text-align: left;
   vertical-align: top;
   outline: 1px solid #333;
   padding: 0.5em;
}
</style>

</head>

<body>
<div class='linkbar'>
<a class="sbpage" href="index.html">Etusivu: ChatGPT-kirja suunnittelumalleista</a>
<a class="sbpage" href="abstract_factory.html">Abstract Factory </a>
<a class="sbpage" href="active_object.html">Active Object </a>
<a class="sbpage" href="adapter.html">Adapter</a>
<a class="sbpage" href="balking.html">Balking</a>
<a class="sbpage" href="binding_properties.html">Binding Properties </a>
<a class="sbpage" href="bridge.html">Bridge</a>
<a class="sbpage" href="builder.html">Builder</a>
<a class="sbpage" href="chain_of_responsibility.html">Chain of Responsibility </a>
<a class="sbpage" href="command.html">Command</a>
<a class="sbpage" href="composite.html">Composite</a>
<a class="sbpage" href="compute_kernel.html">Compute Kernel </a>
<a class="sbpage" href="cpu_atomic_operation.html">CPU Atomic Operation </a>
<a class="sbpage" href="decorator.html">Decorator</a>
<a class="sbpage" href="delegate.html">Delegation</a>
<a class="sbpage" href="dependency_injection.html">Dependency Injection</a>
<a class="sbpage" href="doublechecked_locking.html">Double-Checked Locking </a>
<a class="sbpage" href="eventbased_asynchronous.html">Event-based Asynchronous </a>
<a class="sbpage" href="extension_object.html">Extension Object </a>
<a class="sbpage" href="facade.html">Facade</a>
<a class="sbpage" href="factory_method.html">Factory Method </a>
<a class="sbpage" href="fluent_interface.html">Fluent Interface </a>
<a class="sbpage" href="flyweight.html">Flyweight</a>
<a class="sbpage" href="front_controller.html">Front Controller </a>
<a class="sbpage" href="guarded_suspension.html">Guarded Suspension </a>
<a class="sbpage" href="interpreter.html">Interpreter</a>
<a class="sbpage" href="iterator.html">Iterator</a>
<a class="sbpage" href="join.html">Join</a>
<a class="sbpage" href="lazy_initialization.html">Lazy Initialization</a>
<a class="sbpage" href="lock.html">Lock</a>
<a class="sbpage" href="marker.html">Marker</a>
<a class="sbpage" href="mediator.html">Mediator</a>
<a class="sbpage" href="memento.html">Memento</a>
<a class="sbpage" href="messaging.html">Messaging</a>
<a class="sbpage" href="module.html">Module</a>
<a class="sbpage" href="monitor_object.html">Monitor Object </a>
<a class="sbpage" href="multiton.html">Multiton</a>
<a class="sbpage" href="mvc.html">MVC</a>
<a class="sbpage" href="null_object.html">Null Object </a>
<a class="sbpage" href="object_pool.html">Object Pool </a>
<a class="sbpage" href="observer.html">Observer</a>
<a class="sbpage" href="prototype.html">Prototype</a>
<a class="sbpage" href="proxy.html">Proxy</a>
<a class="sbpage" href="raii.html">RAII</a>
<a class="sbpage" href="reactor.html">Reactor</a>
<a class="sbpage" href="readwrite_lock.html">Read-write Lock </a>
<a class="sbpage" href="scheduler.html">Scheduler </a>
<a class="sbpage" href="scweo.html">Safe Concurrency With Exclusive Ownership </a>
<a class="sbpage" href="servant.html">Servant</a>
<a class="sbpage" href="service_handler.html">Service Handler </a>
<a class="sbpage" href="service_locator.html">Service Locator </a>
<a class="sbpage" href="singleton.html">Singleton</a>
<a class="sbpage" href="state.html">State</a>
<a class="sbpage" href="strategy.html">Strategy</a>
<a class="sbpage" href="thread_pool.html">Thread Pool </a>
<a class="sbpage" href="threadspecific_storage.html">Thread-specific Storage </a>
<a class="sbpage" href="twin.html">Twin</a>
<a class="sbpage" href="visitor.html">Visitor</a>

</div>
<div id="content">
<h2 id="safe-concurrency-with-exclusive-ownership-suunnittelumalli-pythonissa">Safe Concurrency With Exclusive Ownership -suunnittelumalli Pythonissa</h2>
<h3 id="mika-on-safe-concurrency-with-exclusive-ownership">Mikä on Safe Concurrency With Exclusive Ownership?</h3>
<p><strong>Safe Concurrency With Exclusive Ownership</strong> on suunnittelumalli, jossa resurssin (esim. objekti tai tiedosto) omistus annetaan aina vain yhdelle säikeelle tai prosessille kerrallaan. Tämä varmistaa, että resurssiin ei pääse samanaikaisesti käsiksi useampi toimija, mikä estää kilpailevat muutokset ja datakorruptiot.</p>
<blockquote>
<p><strong>Tavoite:</strong><br />
Varmistaa turvallinen rinnakkaisuus hallitsemalla resurssien omistajuutta siten, että vain yksi säie tai prosessi pääsee muokkaamaan resurssia kerrallaan.</p>
</blockquote>
<h2 id="milloin-kayttaa">Milloin käyttää?</h2>
<ul>
<li>Kun resurssien samanaikainen käyttö voi aiheuttaa virheitä tai datakorruptiota</li>
<li>Kun halutaan varmistaa, että vain yksi toimija kerrallaan hallitsee resurssia</li>
<li>Kun halutaan tehdä selkeä ja turvallinen resurssien hallinta rinnakkaisympäristössä</li>
</ul>
<h2 id="esimerkki-exclusive-ownership-lukituksen-avulla-pythonissa">Esimerkki: Exclusive Ownership lukituksen avulla Pythonissa</h2>
<p>Pythonissa tämä malli voidaan toteuttaa lukkojen (locks) avulla, jolloin resurssi annetaan omistukseen vain yhdelle säikeelle kerrallaan.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">ExclusiveResource</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resource_data</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> yrittää päivittää arvoon </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>  <span class="c1"># Exclusive ownership resurssiin</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> omistaa resurssin&quot;</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_data</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Simuloi työtä resurssin kanssa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resource_data</span> <span class="o">=</span> <span class="n">current</span> <span class="o">+</span> <span class="n">value</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> päivitti arvoksi </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_resource_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">resource</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="n">resource</span> <span class="o">=</span> <span class="n">ExclusiveResource</span><span class="p">()</span>

<span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Säie-</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lopullinen arvo: </span><span class="si">{</span><span class="n">resource</span><span class="o">.</span><span class="n">_resource_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="selitys">Selitys:</h3>
<ul>
<li>Lukko (<code>threading.Lock</code>) takaa, että vain yksi säie kerrallaan voi muokata resurssia</li>
<li><code>with self._lock:</code> varmistaa eksklusiivisen omistajuuden päivityksen ajan</li>
<li>Muut säikeet odottavat lukon vapautumista ennen kuin voivat jatkaa</li>
</ul>
<h2 id="esimerkki-exclusive-ownership-objektin-siirrolla-ownership-transfer">Esimerkki: Exclusive Ownership objektin siirrolla (ownership transfer)</h2>
<p>Pythonissa omistajuuden siirtoa voi mallintaa esimerkiksi siirtämällä resurssin käsittely vastuun yhdeltä objektilta toiselle.</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ResourceOwner</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span>

    <span class="k">def</span> <span class="nf">transfer_ownership</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_owner</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Ei omistettavaa resurssia!&quot;</span><span class="p">)</span>
        <span class="n">new_owner</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Omistajuus siirretty </span><span class="si">{</span><span class="n">new_owner</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">use_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> ei omista resurssia&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> käyttää resurssia </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">resource</span> <span class="o">=</span> <span class="s2">&quot;Tärkeä resurssi&quot;</span>
<span class="n">owner1</span> <span class="o">=</span> <span class="n">ResourceOwner</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
<span class="n">owner2</span> <span class="o">=</span> <span class="n">ResourceOwner</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="n">owner1</span><span class="o">.</span><span class="n">use_resource</span><span class="p">()</span>  <span class="c1"># Omistaa resurssin</span>
<span class="n">owner1</span><span class="o">.</span><span class="n">transfer_ownership</span><span class="p">(</span><span class="n">owner2</span><span class="p">)</span>
<span class="n">owner1</span><span class="o">.</span><span class="n">use_resource</span><span class="p">()</span>  <span class="c1"># Ei enää omista</span>
<span class="n">owner2</span><span class="o">.</span><span class="n">use_resource</span><span class="p">()</span>  <span class="c1"># Omistaa nyt resurssin</span>
</code></pre></div>

<h2 id="hyodyt">Hyödyt</h2>
<ul>
<li>Estää kilpailevat muutokset ja datakorruptiot</li>
<li>Selkeä resurssin omistajuuden hallinta</li>
<li>Helpottaa virheiden ja kilpajuoksutilanteiden ehkäisyä rinnakkaisympäristössä</li>
</ul>
<h2 id="haasteet">Haasteet</h2>
<ul>
<li>Lukkojen käyttö voi aiheuttaa suorituskyvyn hidastumista ja kuolemantuhoja, jos lukkoa ei hallita hyvin</li>
<li>Omistajuuden siirto vaatii selkeää suunnittelua, ettei resurssi jää ilman omistajaa</li>
<li>Pythonin GIL rajoittaa CPU-intensiivisen koodin rinnakkaisuutta, mutta malli on silti hyödyllinen IO-sidonnaisissa tapauksissa</li>
</ul>
<h2 id="yhteenveto">Yhteenveto</h2>
<p><strong>Safe Concurrency With Exclusive Ownership</strong> -malli korostaa resurssin selkeää ja turvallista omistajuutta rinnakkaisessa ohjelmoinnissa. Pythonissa lukkojen avulla voidaan toteuttaa eksklusiivinen pääsy resurssiin ja omistajuuden hallinta selkeästi.</p>
<table>
<thead>
<tr>
<th>Ominaisuus</th>
<th>Kuvaus</th>
</tr>
</thead>
<tbody>
<tr>
<td>Malli</td>
<td>Eksklusiivinen resurssin omistus</td>
</tr>
<tr>
<td>Käyttötarkoitus</td>
<td>Turvallinen rinnakkaisuus</td>
</tr>
<tr>
<td>Python-työkalu</td>
<td><code>threading.Lock</code></td>
</tr>
</tbody>
</table>
</div>
</body>
</html>
