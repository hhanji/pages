
<html>
<head>
<title>
Active Object 
</title>
<link rel="stylesheet" href="pygments.css">

<style type='text/css'>
body {
   background: black;
   color: white;
   font-family: sans-serif;
}

.linkbar {
   width: 20%;
   float: left;
   margin: 1em;
   position: fixed;
   height: 90vh;
   overflow-y: auto;
}

.linkbar a{
   color: black;
   background: #aaa;
   border-top: 2px solid #eee;
   border-left: 2px solid #eee;
   border-bottom: 2px solid #666;
   border-right: 2px solid #666;
   padding: 0.2em;
   margin: 0.2em;
   display: block;
   text-decoration: none;
}

.linkbar a:active {
   background: #888;
   border-top: 2px solid #666;
   border-left: 2px solid #666;
   border-bottom: 2px solid #eee;
   border-right: 2px solid #eee;
}

#content {
   display: inline-block;
   margin-left: 25%;
   width: 40em;
   max-width: 70%;
}

td, th {
   text-align: left;
   vertical-align: top;
   outline: 1px solid #333;
   padding: 0.5em;
}
</style>

</head>

<body>
<div class='linkbar'>
<a class="sbpage" href="index.html">Etusivu: ChatGPT-kirja suunnittelumalleista</a>
<a class="sbpage" href="abstract_factory.html">Abstract Factory </a>
<a class="sbpage" href="active_object.html">Active Object </a>
<a class="sbpage" href="adapter.html">Adapter</a>
<a class="sbpage" href="balking.html">Balking</a>
<a class="sbpage" href="binding_properties.html">Binding Properties </a>
<a class="sbpage" href="bridge.html">Bridge</a>
<a class="sbpage" href="builder.html">Builder</a>
<a class="sbpage" href="chain_of_responsibility.html">Chain of Responsibility </a>
<a class="sbpage" href="command.html">Command</a>
<a class="sbpage" href="composite.html">Composite</a>
<a class="sbpage" href="compute_kernel.html">Compute Kernel </a>
<a class="sbpage" href="cpu_atomic_operation.html">CPU Atomic Operation </a>
<a class="sbpage" href="decorator.html">Decorator</a>
<a class="sbpage" href="delegate.html">Delegation</a>
<a class="sbpage" href="dependency_injection.html">Dependency Injection</a>
<a class="sbpage" href="doublechecked_locking.html">Double-Checked Locking </a>
<a class="sbpage" href="eventbased_asynchronous.html">Event-based Asynchronous </a>
<a class="sbpage" href="extension_object.html">Extension Object </a>
<a class="sbpage" href="facade.html">Facade</a>
<a class="sbpage" href="factory_method.html">Factory Method </a>
<a class="sbpage" href="fluent_interface.html">Fluent Interface </a>
<a class="sbpage" href="flyweight.html">Flyweight</a>
<a class="sbpage" href="front_controller.html">Front Controller </a>
<a class="sbpage" href="guarded_suspension.html">Guarded Suspension </a>
<a class="sbpage" href="interpreter.html">Interpreter</a>
<a class="sbpage" href="iterator.html">Iterator</a>
<a class="sbpage" href="join.html">Join</a>
<a class="sbpage" href="lazy_initialization.html">Lazy Initialization</a>
<a class="sbpage" href="lock.html">Lock</a>
<a class="sbpage" href="marker.html">Marker</a>
<a class="sbpage" href="mediator.html">Mediator</a>
<a class="sbpage" href="memento.html">Memento</a>
<a class="sbpage" href="messaging.html">Messaging</a>
<a class="sbpage" href="module.html">Module</a>
<a class="sbpage" href="monitor_object.html">Monitor Object </a>
<a class="sbpage" href="multiton.html">Multiton</a>
<a class="sbpage" href="mvc.html">MVC</a>
<a class="sbpage" href="null_object.html">Null Object </a>
<a class="sbpage" href="object_pool.html">Object Pool </a>
<a class="sbpage" href="observer.html">Observer</a>
<a class="sbpage" href="prototype.html">Prototype</a>
<a class="sbpage" href="proxy.html">Proxy</a>
<a class="sbpage" href="raii.html">RAII</a>
<a class="sbpage" href="reactor.html">Reactor</a>
<a class="sbpage" href="readwrite_lock.html">Read-write Lock </a>
<a class="sbpage" href="scheduler.html">Scheduler </a>
<a class="sbpage" href="scweo.html">Safe Concurrency With Exclusive Ownership </a>
<a class="sbpage" href="servant.html">Servant</a>
<a class="sbpage" href="service_handler.html">Service Handler </a>
<a class="sbpage" href="service_locator.html">Service Locator </a>
<a class="sbpage" href="singleton.html">Singleton</a>
<a class="sbpage" href="state.html">State</a>
<a class="sbpage" href="strategy.html">Strategy</a>
<a class="sbpage" href="thread_pool.html">Thread Pool </a>
<a class="sbpage" href="threadspecific_storage.html">Thread-specific Storage </a>
<a class="sbpage" href="twin.html">Twin</a>
<a class="sbpage" href="visitor.html">Visitor</a>

</div>
<div id="content">
<h2 id="active-object-suunnittelumalli-pythonissa">Active Object -suunnittelumalli Pythonissa</h2>
<h3 id="mika-on-active-object">Mikä on Active Object?</h3>
<p><strong>Active Object</strong> -malli auttaa hallitsemaan rinnakkaisuutta ja monisäikeisyyttä eriyttämällä metodikutsut ja niiden suorittamisen toisistaan. Active Object vastaanottaa kutsut ja suorittaa ne omassa säikeessään asynkronisesti, mikä helpottaa synkronointia ja parantaa suorituskykyä ilman, että asiakasolioiden tarvitsee itse hallita säikeitä.</p>
<blockquote>
<p><strong>Tavoite:</strong><br />
Poistaa monisäikeisyyden hallinnan monimutkaisuutta tarjoamalla asynkroninen rajapinta olion toimintaan.</p>
</blockquote>
<h2 id="mallin-paaosat">Mallin pääosat</h2>
<ul>
<li><strong>Proxy</strong>: vastaanottaa kutsut ja siirtää ne jonoon</li>
<li><strong>Scheduler</strong>: hallitsee kutsujen ajastamista ja suorittamista</li>
<li><strong>Servant</strong>: suorittaa varsinaisen työn</li>
<li><strong>Future</strong>: tarjoaa tuloksen lupauksen (future), joka voidaan hakea myöhemmin</li>
</ul>
<h2 id="yksinkertainen-python-esimerkki">Yksinkertainen Python-esimerkki</h2>
<h3 id="1-future-luokka-tuloksen-lupaaja">1. Future-luokka: tuloksen lupaaja</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">class</span> <span class="nc">Future</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ready</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result</span>
</code></pre></div>

<h3 id="2-servant-luokka-toteuttaa-varsinaisen-tyon">2. Servant-luokka: toteuttaa varsinaisen työn</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Servant</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">long_running_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tehtävä käynnissä...&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Simuloi raskasta laskentaa</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div>

<h3 id="3-active-object-luokka-saie-ja-jonon-hallinta">3. Active Object -luokka: säie ja jonon hallinta</h3>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">queue</span>

<span class="k">class</span> <span class="nc">ActiveObject</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_servant</span> <span class="o">=</span> <span class="n">Servant</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requests</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">future</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">long_running_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">future</span> <span class="o">=</span> <span class="n">Future</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requests</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_servant</span><span class="o">.</span><span class="n">long_running_task</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">{},</span> <span class="n">future</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">future</span>
</code></pre></div>

<h3 id="4-kaytto">4. Käyttö</h3>
<div class="codehilite"><pre><span></span><code><span class="n">active_object</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="n">future_result</span> <span class="o">=</span> <span class="n">active_object</span><span class="o">.</span><span class="n">long_running_task</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tehtävä lähetetty, voidaan jatkaa muita töitä...&quot;</span><span class="p">)</span>

<span class="c1"># Haetaan tulos myöhemmin</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">future_result</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tehtävän tulos: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Tulostus:</strong></p>
<div class="codehilite"><pre><span></span><code>Tehtävä lähetetty, voidaan jatkaa muita töitä...
Tehtävä käynnissä...
Tehtävän tulos: 30
</code></pre></div>

<h2 id="hyodyt">Hyödyt</h2>
<ul>
<li>Erotetaan metodikutsujen lähettäminen ja suorittaminen omiin kokonaisuuksiinsa</li>
<li>Helpottaa monisäikeisyyden hallintaa ja synkronointia</li>
<li>Parantaa suorituskykyä sallimalla asynkronisen työn jatkamisen</li>
<li>Tarjoaa siistin ja selkeän rajapinnan rinnakkaiseen ohjelmointiin</li>
</ul>
<h2 id="haitat">Haitat</h2>
<ul>
<li>Lisää hieman monimutkaisuutta koodiin</li>
<li>Vaatii huolellista resurssien hallintaa (esim. säikeet, jonot)</li>
<li>Ei aina paras ratkaisu hyvin yksinkertaisiin tapauksiin</li>
</ul>
<h2 id="yhteenveto">Yhteenveto</h2>
<table>
<thead>
<tr>
<th>Osa</th>
<th>Kuvaus</th>
</tr>
</thead>
<tbody>
<tr>
<td>Proxy</td>
<td>Vastaanottaa kutsut ja lisää ne jonoon</td>
</tr>
<tr>
<td>Scheduler</td>
<td>Suorittaa kutsut säikeessä jonosta</td>
</tr>
<tr>
<td>Servant</td>
<td>Toteuttaa varsinaisen toiminnallisuuden</td>
</tr>
<tr>
<td>Future</td>
<td>Tarjoaa mahdollisuuden hakea tulos myöhemmin</td>
</tr>
</tbody>
</table>
<p><strong>Active Object -malli</strong> on erinomainen työkalu, kun halutaan hallita rinnakkaisuutta ja tarjota asiakkaille asynkroninen, selkeä ja turvallinen rajapinta olion toimintaan.</p>
</div>
</body>
</html>
